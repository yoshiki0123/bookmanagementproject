{% load static %}
<!doctype html>
<html lang="ja">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Book Management</title>

    <!-- Bootstrap CSS（標準色のまま） -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-9ndCyUaIbzAi2FUVXJi0CjmCapSmO7SnpJef0486qhLnuZ2cdeRhO02iuK6FUUVM" crossorigin="anonymous">
    {% block customcss %}{% endblock customcss %}

    <style>
      /* 全体は白ベース＋薄いグレーの区切りのみ */
      body{
        font-family: system-ui, -apple-system, "Segoe UI", Roboto, "Noto Sans JP", "Helvetica Neue", Arial, sans-serif;
        letter-spacing: .02em;
        background-color: #f8f9fa; /* Bootstrapの淡いグレー */
      }
      /* シンプルなナビバー：白背景＋ボーダー＋小さな影 */
      .navbar-clean{
        background-color: #ffffff;
        border-bottom: 1px solid #e9ecef;
      }
      /* アクティブリンクは下線で強調（色はBootstrapのprimary） */
      .navbar .nav-link.active{
        font-weight: 600;
        position: relative;
      }
      .navbar .nav-link.active::after{
        content:"";
        position: absolute; left: .5rem; right: .5rem; bottom: .35rem;
        height: 2px; border-radius: 2px;
        background-color: var(--bs-primary);
      }
      /* ページヘッダは薄い帯＋下ボーダーのみ */
      .page-header{
        background-color: #f8f9fa;
        border-bottom: 1px solid #e9ecef;
      }
      /* トースト：右上に重ねるだけ（色はBootstrap任せ） */
      .toast-stack{
        position: fixed; top: 1rem; right: 1rem; z-index: 1080;
      }
      /* スクロールトップ（必要なら活用、色は標準） */
      #scrollTopBtn{
        position: fixed; right: 1.25rem; bottom: 1.25rem; display: none; z-index: 1080;
      }
    </style>
  </head>

  <body>
    <!-- Sticky（固定）ナビバー：シンプルな白＋ボーダー -->
    <nav class="navbar navbar-expand-lg navbar-clean sticky-top shadow-sm">
      <div class="container-fluid">
        <a class="navbar-brand fw-semibold" href="{% url 'bookmanagement:home' %}">
          野原研究室 図書管理アプリ
        </a>

        <div class="d-flex align-items-center gap-3 order-lg-2">
          {% if user.is_authenticated %}
            <span class="navbar-text small text-nowrap">
              ようこそ、<strong>{{ user.get_full_name|default:user.username }}</strong> さん
            </span>
          {% endif %}
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav"
                  aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
            <span class="navbar-toggler-icon"></span>
          </button>
        </div>

        <div class="collapse navbar-collapse order-lg-1" id="navbarNav">
          {% with url_name=request.resolver_match.url_name %}
          <ul class="navbar-nav ms-lg-4">
            <li class="nav-item">
              <a class="nav-link {% if url_name == 'home' %}active{% endif %}" href="{% url 'bookmanagement:home' %}">🏠 ホーム</a>
            </li>
            <li class="nav-item">
              <a class="nav-link {% if url_name == 'borrow' %}active{% endif %}" href="{% url 'bookmanagement:borrow' %}">📤 書籍貸出</a>
            </li>
            <li class="nav-item">
              <a class="nav-link {% if url_name == 'return' %}active{% endif %}" href="{% url 'bookmanagement:return' %}">🔄 書籍返却</a>
            </li>
            <li class="nav-item">
              <a class="nav-link {% if url_name == 'book_list' %}active{% endif %}" href="{% url 'bookmanagement:book_list' %}">📚 書籍一覧</a>
            </li>
            <li class="nav-item">
              <a class="nav-link {% if url_name == 'add_book' %}active{% endif %}" href="{% url 'bookmanagement:add_book' %}">📝 書籍登録</a>
            </li>
            <li class="nav-item">
              <a class="nav-link {% if url_name == 'loan_status' %}active{% endif %}" href="{% url 'bookmanagement:loan_status' %}">📖 貸出状況</a>
            </li>
            <li class="nav-item">
              <a class="nav-link {% if url_name == 'logout' %}active{% endif %}" href="{% url 'bookmanagement:logout' %}">🚪 ログアウト</a>
            </li>
          </ul>
          {% endwith %}
        </div>
      </div>
    </nav>

    <!-- ページヘッダ（各ページの見出しをここに） -->
    <header class="page-header">
      <div class="container py-3">
        {% block header %}{% endblock header %}
      </div>
    </header>

    <!-- Django messages をトーストで表示（任意） -->
    {% if messages %}
    <div class="toast-stack">
      {% for message in messages %}
        {% with tag=message.tags %}
        <div class="toast align-items-center text-bg-{% if tag == 'error' %}danger{% else %}{{ tag|default:'secondary' }}{% endif %} border-0 mb-2"
             role="alert" aria-live="assertive" aria-atomic="true" data-bs-delay="3000">
          <div class="d-flex">
            <div class="toast-body">{{ message }}</div>
            <button type="button" class="btn-close btn-close-white me-2 m-auto"
                    data-bs-dismiss="toast" aria-label="Close"></button>
          </div>
        </div>
        {% endwith %}
      {% endfor %}
    </div>
    {% endif %}

    <!-- メイン -->
    <main class="container py-4">
      {% block content %}{% endblock content %}
    </main>

    <!-- フッター（必要最低限） -->
    <footer class="border-top py-4">
      <div class="container small d-flex justify-content-between flex-wrap gap-2 text-muted">
        <span>&copy; {{ now|default:None|date:"Y" }} Nohara Lab Library App</span>
        <span>v1.0</span>
      </div>
    </footer>

    <!-- Scroll to top（任意） -->
    <button id="scrollTopBtn" class="btn btn-primary rounded-circle">
      ↑
    </button>

    <!-- jQuery（必要なら） -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.7.1/jquery.min.js"></script>
    <!-- Bootstrap Bundle -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js" integrity="sha384-geWF76RCwLtnZ8qwWowPQNguL3RmwHVBC9FhGdlKrxdiJJigb/j/68SIy3Te4Bkz" crossorigin="anonymous"></script>
    <!-- 共通JS -->
    <script src="{% static 'js/common.js' %}"></script>

    <script>
      // スクロールトップ（必要なければ削除OK）
      (function(){
        const btn = document.getElementById('scrollTopBtn');
        window.addEventListener('scroll', () => {
          btn.style.display = (window.scrollY > 300) ? 'inline-flex' : 'none';
        });
        btn.addEventListener('click', () => window.scrollTo({top: 0, behavior: 'smooth'}));
      })();
    </script>

    {% block customscript %}{% endblock customscript %}
  </body>
</html>
